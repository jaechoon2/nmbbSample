{"ts":1357687414457,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports = function(app, config, mongoose, Status, nodemailer) {\n  var crypto = require('crypto');\n\n  var Status = new mongoose.Schema({\n    name: {\n      first:   { type: String },\n      last:    { type: String }\n    },\n    status:    { type: String }\n  });\n\n  var schemaOptions = {\n    toJSON: {\n      virtuals: true\t\n    },\n    toObject: {\n      virtuals: true\n    }\n  };\n\n  var Contact = new mongoose.Schema({\n    name: {\n      first:   { type: String },\n      last:    { type: String }\n    },\n    accountId: { type: mongoose.Schema.ObjectId },\n    added:     { type: Date },     // When the contact was added\n    updated:   { type: Date }      // When the contact last updated\n  }, schemaOptions);\n\n  Contact.virtual('online').get(function(){\n    return app.isAccountOnline(this.get('accountId'));\n  });\n\n  var AccountSchema = new mongoose.Schema({\n    email:     { type: String, unique: true },\n    password:  { type: String },\n    name: {\n      first:   { type: String },\n      last:    { type: String },\n      full:    { type: String }\n    },\n    birthday: {\n      day:     { type: Number, min: 1, max: 31, required: false },\n      month:   { type: Number, min: 1, max: 12, required: false },\n      year:    { type: Number }\n    },\n    photoUrl:  { type: String },\n    biography: { type: String },\n    contacts:  [Contact],\n    status:    [Status], // My own status updates only\n    activity:  [Status]  //  All status updates including friends\n  });\n\n  var Account = mongoose.model('Account', AccountSchema);\n\n  var registerCallback = function(err) {\n    if (err) {\n      return console.log(err);\n    };\n    return console.log('Account was created');\n  };\n\n  var changePassword = function(accountId, newpassword) {\n    var shaSum = crypto.createHash('sha256');\n    shaSum.update(newpassword);\n    var hashedPassword = shaSum.digest('hex');\n    Account.update({_id:accountId}, {$set: {password:hashedPassword}},{upsert:false},\n      function changePasswordCallback(err) {\n        console.log('Change password done for account ' + accountId);\n    });\n  };\n\n  var forgotPassword = function(email, resetPasswordUrl, callback) {\n    var user = Account.findOne({email: email}, function findAccount(err, doc){\n      if (err) {\n        // Email address is not a valid user\n        callback(false);\n      } else {\n        var smtpTransport = nodemailer.createTransport('SMTP', config.mail);\n        resetPasswordUrl += '?account=' + doc._id;\n        smtpTransport.sendMail({\n          from: 'thisapp@example.com',\n          to: doc.email,\n          subject: 'SocialNet Password Request',\n          text: 'Click here to reset your password: ' + resetPasswordUrl\n        }, function forgotPasswordResult(err) {\n          if (err) {\n            callback(false);\n          } else {\n            callback(true);\n          }\n        });\n      }\n    });\n  };\n\n  var login = function(email, password, callback) {\n    var shaSum = crypto.createHash('sha256');\n    shaSum.update(password);\n    Account.findOne({email:email,password:shaSum.digest('hex')},function(err,doc){\n      callback(doc);\n    });\n  };\n\n  var findByString = function(searchStr, callback) {\n    var searchRegex = new RegExp(searchStr, 'i');\n    Account.find({\n      $or: [\n        { 'name.full': { $regex: searchRegex } },\n        { email:       { $regex: searchRegex } }\n      ]\n    }, callback);\n  };\n\n  var findById = function(accountId, callback) {\n    Account.findOne({_id:accountId}, function(err,doc) {\n      callback(doc);\n    });\n  };\n\n  var addContact = function(account, addcontact) {\n    contact = {\n      name: addcontact.name,\n      accountId: addcontact._id,\n      added: new Date(),\n      updated: new Date()\n    };\n    account.contacts.push(contact);\n\n    account.save(function (err) {\n      if (err) {\n        console.log('Error saving account: ' + err);\n      }\n    });\n  };\n\n  var removeContact = function(account, contactId) {\n    if ( null == account.contacts ) return;\n\n    account.contacts.forEach(function(contact) {\n      if ( contact.accountId == contactId ) {\n        account.contacts.remove(contact);\n      }\n    });\n    account.save();\n  };\n\n  var hasContact = function(account, contactId) {\n    if ( null == account.contacts ) return false;\n\n    account.contacts.forEach(function(contact) {\n      if ( contact.accountId == contactId ) {\n        return true;\n      }\n    });\n    return false;\n  };\n\n  var register = function(email, password, firstName, lastName) {\n    var shaSum = crypto.createHash('sha256');\n    shaSum.update(password);\n\n    console.log('Registering ' + email);\n    var user = new Account({\n      email: email,\n      name: {\n        first: firstName,\n        last: lastName,\n        full: firstName + ' ' + lastName\n      },\n      password: shaSum.digest('hex')\n    });\n    user.save(registerCallback);\n    console.log('Save command was sent');\n  };\n\n  return {\n    findById: findById,\n    register: register,\n    hasContact: hasContact,\n    forgotPassword: forgotPassword,\n    changePassword: changePassword,\n    findByString: findByString,\n    addContact: addContact,\n    removeContact: removeContact,\n    login: login,\n    Account: Account\n  }\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":5164}]],"length":5164}
{"contributors":[],"silentsave":false,"ts":1357694525827,"patch":[[{"diffs":[[0,"tact) {\n    "],[1,"var "],[0,"contact = {\n"]],"start1":3553,"start2":3553,"length1":24,"length2":28},{"diffs":[[0,"    if ( null =="],[1,"="],[0," account.contact"]],"start1":3917,"start2":3917,"length1":32,"length2":33}]],"length":5169,"saved":false}
{"ts":1357695143945,"patch":[[{"diffs":[[0,"ose,"],[-1," Status,"],[0," nod"]],"start1":44,"start2":44,"length1":16,"length2":8}]],"length":5161,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357871696065,"patch":[[{"diffs":[[0," null =="],[1,"="],[0," account"]],"start1":4192,"start2":4192,"length1":16,"length2":17}]],"length":5162,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357873872591,"patch":[[{"diffs":[[0,"dcontact) {\n"],[1,"      console.log('addContact:');\n      console.dir(addContact);\n"],[0,"    var cont"]],"start1":3541,"start2":3541,"length1":24,"length2":89}]],"length":5227,"saved":false}
{"ts":1357874055426,"patch":[[{"diffs":[[0,".dir(add"],[-1,"C"],[1,"c"],[0,"ontact);"]],"start1":3600,"start2":3600,"length1":17,"length2":17}]],"length":5227,"saved":false}
{"ts":1357874338095,"patch":[[{"diffs":[[0,"    "],[-1,"console.dir(addcontact);"],[0,"\n   "]],"start1":3589,"start2":3589,"length1":32,"length2":8},{"diffs":[[0,"te()\n    };\n"],[1,"    console.dir(contact);\n"],[0,"    account."]],"start1":3722,"start2":3722,"length1":24,"length2":50}]],"length":5229,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358104780673,"patch":[[{"diffs":[[0,"le.log('"],[1," models."],[0,"addConta"]],"start1":3564,"start2":3564,"length1":16,"length2":24},{"diffs":[[0,";\n      "],[1,"console.dir(addcontact);"],[0,"\n   "],[-1," var"],[0," contact"]],"start1":3593,"start2":3593,"length1":24,"length2":44}]],"length":5257,"saved":false}
{"ts":1358105374232,"patch":[[{"diffs":[[0,"e.log(' "],[1,">>"],[0,"models.a"]],"start1":3565,"start2":3565,"length1":16,"length2":18}]],"length":5259,"saved":false}
{"ts":1358105995221,"patch":[[{"diffs":[[0,"{ type: String }"],[1,",\n      full:     {type: String},"],[0,"\n    },\n    acco"]],"start1":472,"start2":472,"length1":32,"length2":65},{"diffs":[[0,"t:');\n      "],[1,"//"],[0,"console.dir("]],"start1":3624,"start2":3624,"length1":24,"length2":26},{"diffs":[[0,"ntact);\n    "],[1,"var "],[0,"contact = {\n"]],"start1":3655,"start2":3655,"length1":24,"length2":28},{"diffs":[[0,"{\n      "],[-1,"name"],[1,"accountId"],[0,": addcon"]],"start1":3681,"start2":3681,"length1":20,"length2":25},{"diffs":[[0,"act."],[-1,"name"],[1,"_id"],[0,",\n      "],[-1,"accountId"],[1,"name"],[0,": ad"]],"start1":3707,"start2":3707,"length1":29,"length2":23},{"diffs":[[0,"ame: addcontact."],[-1,"_id"],[1,"name"],[0,",\n      added: n"]],"start1":3723,"start2":3723,"length1":35,"length2":36}]],"length":5298,"saved":false}
{"ts":1358106195971,"patch":[[{"diffs":[[0,"{\n      "],[-1,"accountId"],[1,"name"],[0,": addcon"]],"start1":3681,"start2":3681,"length1":25,"length2":20},{"diffs":[[0,"act."],[-1,"_id"],[1,"name"],[0,",\n      "],[-1,"name"],[1,"accountId"],[0,": ad"]],"start1":3702,"start2":3702,"length1":23,"length2":29},{"diffs":[[0,"tId: addcontact."],[-1,"name"],[1,"_id"],[0,",\n      added: n"]],"start1":3724,"start2":3724,"length1":36,"length2":35}]],"length":5298,"saved":false}
{"ts":1358107278752,"patch":[[{"diffs":[[0,"ddcontact);\n"],[1,"\n"],[0,"    var cont"]],"start1":3651,"start2":3651,"length1":24,"length2":25},{"diffs":[[0,"ntact = "],[1,"new Contact("],[0,"{\n      "]],"start1":3674,"start2":3674,"length1":16,"length2":28},{"diffs":[[0,"()\n    }"],[1,")"],[0,";\n    "],[1,"//"],[0,"console."]],"start1":3806,"start2":3806,"length1":22,"length2":25}]],"length":5314,"saved":false}
{"ts":1358108977983,"patch":[[{"diffs":[[0,"ng }"],[-1,",\n      full:     {type: String},"],[0,"\n   "]],"start1":484,"start2":484,"length1":41,"length2":8},{"diffs":[[0,"t = "],[-1,"new Contact("],[0,"{\n  "]],"start1":3645,"start2":3645,"length1":20,"length2":8},{"diffs":[[0,"    name"],[1,": {first: addcontact.name.first, last"],[0,": addcon"]],"start1":3653,"start2":3653,"length1":16,"length2":53},{"diffs":[[0,"act.name"],[1,".last}"],[0,",\n      "]],"start1":3707,"start2":3707,"length1":16,"length2":22},{"diffs":[[0,"Date()\n    }"],[-1,")"],[0,";\n    //cons"]],"start1":3800,"start2":3800,"length1":25,"length2":24}]],"length":5311,"saved":false}
{"ts":1358110439673,"patch":[[{"diffs":[[0,"iler) {\n"],[1,"  "],[0,"  var cr"]],"start1":55,"start2":55,"length1":16,"length2":18},{"diffs":[[0,"'crypto');\n\n"],[1,"  "],[0,"  var Status"]],"start1":88,"start2":88,"length1":24,"length2":26},{"diffs":[[0,"chema({\n    "],[1,"   "],[1," "],[0,"name: {\n"],[1,"      "],[0,"      first:"]],"start1":131,"start2":131,"length1":32,"length2":42},{"diffs":[[0,"          first:"],[1," {\n          "],[0,"   "],[-1,"{"],[1,"  "],[0," type: String },"]],"start1":157,"start2":157,"length1":36,"length2":50},{"diffs":[[0,": String"],[-1," },\n"],[1,"\n            },\n     "],[0,"      "],[1," "],[0,"last: "],[1,"{\n"],[0,"   "],[-1,"{"],[1,"            "],[0," type: S"]],"start1":196,"start2":196,"length1":36,"length2":67},{"diffs":[[0,"ring"],[1,"\n           "],[0," }\n    "],[1,"  "],[1,"  "],[0,"},\n    "],[1," "],[1,"   "],[0,"status: "],[1,"{\n        "],[0,"   "],[-1,"{"],[0," typ"]],"start1":264,"start2":264,"length1":34,"length2":63},{"diffs":[[0,"ring"],[1,"\n       "],[0," }\n  "],[1," "],[1," "],[0,"});\n\n"],[1,"  "],[0,"  va"]],"start1":332,"start2":332,"length1":18,"length2":30},{"diffs":[[0,"Options = {\n"],[1,"    "],[0,"    toJSON: "]],"start1":370,"start2":370,"length1":24,"length2":28},{"diffs":[[0,"toJSON: {\n      "],[1,"   "],[1,"   "],[0,"virtuals: true\t\n"]],"start1":390,"start2":390,"length1":32,"length2":38},{"diffs":[[0,"true"],[-1,"\t"],[0,"\n"],[1,"   "],[0,"    "],[1," "],[0,"},\n"],[1,"    "],[0,"    "]],"start1":422,"start2":422,"length1":17,"length2":24},{"diffs":[[0,"ct: {\n      "],[1,"  "],[1,"    "],[0,"virtuals: tr"]],"start1":452,"start2":452,"length1":24,"length2":30},{"diffs":[[0,"    "],[1,"  "],[1,"  "],[0,"}\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  va"]],"start1":485,"start2":485,"length1":16,"length2":24},{"diffs":[[0,"se.Schema({\n"],[1,"    "],[0,"    name: {\n"]],"start1":531,"start2":531,"length1":24,"length2":28},{"diffs":[[0,"me: {\n      "],[1,"   "],[1,"   "],[0,"first: "],[1,"{\n             "],[0,"  "],[-1,"{"],[0," type: Strin"]],"start1":553,"start2":553,"length1":34,"length2":54},{"diffs":[[0,"    type: String"],[1,"\n           "],[0," },\n      last: "]],"start1":592,"start2":592,"length1":32,"length2":44},{"diffs":[[0,"   },\n      "],[1,"   "],[1,"   "],[0,"last:"],[1," {\n"],[0,"    "],[-1,"{"],[1,"           "],[0," type: Strin"]],"start1":618,"start2":618,"length1":34,"length2":53},{"diffs":[[0,"type: String"],[1,"\n           "],[0," }\n    "],[1,"  "],[1,"  "],[0,"},\n"],[1,"    "],[0,"    accountI"]],"start1":660,"start2":660,"length1":34,"length2":54},{"diffs":[[0,"untId: {"],[1,"\n           "],[0," type: m"]],"start1":710,"start2":710,"length1":16,"length2":28},{"diffs":[[0,"ctId"],[1,"\n       "],[0," },\n    "],[1," "],[1,"   "],[0,"added:"],[1," {\n "],[0,"     "],[-1,"{"],[1,"     "],[0," typ"]],"start1":757,"start2":757,"length1":28,"length2":48},{"diffs":[[0,"Date"],[-1," },"],[1,"\n  "],[0,"    "],[1,"  },"],[0," // "]],"start1":808,"start2":808,"length1":15,"length2":19},{"diffs":[[0,"s added\n"],[1,"    "],[0,"    upda"]],"start1":846,"start2":846,"length1":16,"length2":20},{"diffs":[[0,"pdated: "],[1,"{\n         "],[0,"  "],[-1,"{"],[0," type: D"]],"start1":863,"start2":863,"length1":19,"length2":29},{"diffs":[[0,"Date"],[1,"\n  "],[0," "],[-1,"}"],[0,"     "],[1,"}"],[0," // "]],"start1":891,"start2":891,"length1":15,"length2":18},{"diffs":[[0,"updated\n"],[1,"  "],[0,"  }, sch"]],"start1":931,"start2":931,"length1":16,"length2":18},{"diffs":[[0,"ions);\n\n"],[1,"  "],[0,"  Contac"]],"start1":955,"start2":955,"length1":16,"length2":18},{"diffs":[[0,"nction()"],[1," "],[0,"{\n"],[1,"    "],[0,"    retu"]],"start1":999,"start2":999,"length1":18,"length2":23},{"diffs":[[0,"tId'));\n"],[1,"  "],[0,"  });\n\n"],[1,"  "],[0,"  var Ac"]],"start1":1061,"start2":1061,"length1":23,"length2":27},{"diffs":[[0,"se.Schema({\n"],[1,"    "],[0,"    email:  "]],"start1":1112,"start2":1112,"length1":24,"length2":28},{"diffs":[[0," email: "],[1,"{\n"],[0,"    "],[-1,"{"],[1,"       "],[0," type: S"]],"start1":1131,"start2":1131,"length1":21,"length2":29},{"diffs":[[0," String,"],[1,"\n           "],[0," unique:"]],"start1":1158,"start2":1158,"length1":16,"length2":28},{"diffs":[[0,"true"],[-1," },\n    password:  { type: String },\n"],[1,"\n        },\n        password: {\n            type: String\n        },\n    "],[0,"    "]],"start1":1187,"start2":1187,"length1":45,"length2":80},{"diffs":[[0,"    "],[1," "],[1,"     "],[0,"first: "],[1,"{\n             "],[0,"  "],[-1,"{"],[0," typ"]],"start1":1277,"start2":1277,"length1":18,"length2":38},{"diffs":[[0,"    type: String"],[1,"\n           "],[0," },\n      last: "]],"start1":1308,"start2":1308,"length1":32,"length2":44},{"diffs":[[0,"    "],[1," "],[1,"     "],[0,"last: "],[-1,"   { type: String },\n      full:    {"],[1,"{\n                type: String\n            },\n            full: {\n               "],[0," typ"]],"start1":1342,"start2":1342,"length1":51,"length2":101},{"diffs":[[0,": String"],[1,"\n           "],[0," }\n    "],[1," "],[-1,"},\n"],[1,"   },\n   "],[0,"    "],[1," "],[0,"birthday"]],"start1":1444,"start2":1444,"length1":30,"length2":50},{"diffs":[[0,"birthday: {\n"],[1,"      "],[0,"      day:  "]],"start1":1486,"start2":1486,"length1":24,"length2":30},{"diffs":[[0,"   day: "],[1,"{\n"],[0,"    "],[-1,"{"],[1,"           "],[0," type: N"]],"start1":1507,"start2":1507,"length1":21,"length2":33},{"diffs":[[0,"ber,"],[-1," min: 1, max: 31, required: false },\n      month:   { type: Number, min: 1, max: 12,"],[1,"\n                min: 1,\n                max: 31,\n                required: false\n            },\n            month: {\n                type: Number,\n                min: 1,\n                max: 12,\n               "],[0," req"]],"start1":1542,"start2":1542,"length1":92,"length2":220},{"diffs":[[0,"d: false"],[1,"\n           "],[0," },\n    "]],"start1":1766,"start2":1766,"length1":16,"length2":28},{"diffs":[[0,"    "],[1,"   "],[1,"   "],[0,"year:"],[1," {\n"],[0,"    "],[-1,"{"],[1,"           "],[0," typ"]],"start1":1792,"start2":1792,"length1":18,"length2":37},{"diffs":[[0,"mber"],[-1," }\n"],[1,"\n            }\n   "],[0,"    "],[1," "],[0,"},\n"],[1,"    "],[0,"    "]],"start1":1834,"start2":1834,"length1":18,"length2":38},{"diffs":[[0,"otoUrl: "],[-1," "],[0,"{"],[1,"\n           "],[0," type: S"]],"start1":1874,"start2":1874,"length1":18,"length2":29},{"diffs":[[0,"type: String"],[1,"\n       "],[0," },\n"],[1,"    "],[0,"    biograph"]],"start1":1896,"start2":1896,"length1":28,"length2":40},{"diffs":[[0,"raphy: {"],[1,"\n           "],[0," type: S"]],"start1":1932,"start2":1932,"length1":16,"length2":28},{"diffs":[[0,": String"],[1,"\n       "],[0," },\n    "],[1,"   "],[1," "],[0,"contacts"]],"start1":1957,"start2":1957,"length1":24,"length2":36},{"diffs":[[0,"ontacts:"],[-1," "],[0," [Contac"]],"start1":1986,"start2":1986,"length1":17,"length2":16},{"diffs":[[0,"    "],[1,"   "],[1," "],[0,"status:"],[-1,"   "],[0," [St"]],"start1":2006,"start2":2006,"length1":18,"length2":19},{"diffs":[[0,"es only\n"],[1,"    "],[0,"    acti"]],"start1":2054,"start2":2054,"length1":16,"length2":20},{"diffs":[[0,"ctivity:"],[-1," "],[0," [Status"]],"start1":2071,"start2":2071,"length1":17,"length2":16},{"diffs":[[0,"[Status]"],[-1," "],[0," //  All"]],"start1":2080,"start2":2080,"length1":17,"length2":16},{"diffs":[[0,"friends\n"],[1,"  "],[0,"  });\n\n"],[1,"  "],[0,"  var Ac"]],"start1":2122,"start2":2122,"length1":23,"length2":27},{"diffs":[[0,"Schema);\n\n  "],[1," "],[1," "],[0,"var register"]],"start1":2190,"start2":2190,"length1":24,"length2":26},{"diffs":[[0,"tion(err) {\n"],[1,"    "],[0,"    if (err)"]],"start1":2231,"start2":2231,"length1":24,"length2":28},{"diffs":[[0,"rr) {\n      "],[1," "],[1,"     "],[0,"return conso"]],"start1":2256,"start2":2256,"length1":24,"length2":30},{"diffs":[[0,"g(err);\n    "],[-1,"};\n"],[1,"    };\n    "],[0,"    return c"]],"start1":2291,"start2":2291,"length1":27,"length2":35},{"diffs":[[0,"reated');\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  var change"]],"start1":2351,"start2":2351,"length1":28,"length2":32},{"diffs":[[0,"password) {\n"],[1,"    "],[0,"    var shaS"]],"start1":2417,"start2":2417,"length1":24,"length2":28},{"diffs":[[0,"Hash('sha256');\n"],[1,"    "],[0,"    shaSum.updat"]],"start1":2463,"start2":2463,"length1":32,"length2":36},{"diffs":[[0,"sword);\n    "],[1,"  "],[1,"  "],[0,"var hashedPa"]],"start1":2507,"start2":2507,"length1":24,"length2":28},{"diffs":[[0,"est('hex');\n"],[1,"    "],[0,"    Account."]],"start1":2554,"start2":2554,"length1":24,"length2":28},{"diffs":[[0,"update({"],[1,"\n            "],[0,"_id:"],[1," "],[0,"accountI"]],"start1":2582,"start2":2582,"length1":20,"length2":34},{"diffs":[[0,"ntId"],[-1,"}, {$set: {"],[1,"\n        }, {\n            $set: {\n                "],[0,"pass"]],"start1":2613,"start2":2613,"length1":19,"length2":58},{"diffs":[[0,"assword:"],[1," "],[0,"hashedPa"]],"start1":2668,"start2":2668,"length1":16,"length2":17},{"diffs":[[0,"word"],[-1,"}},{"],[1,"\n            }\n        }, {\n            "],[0,"upsert:"],[1," "],[0,"false"],[-1,"},\n"],[1,"\n        },\n\n  "],[0,"    "]],"start1":2687,"start2":2687,"length1":27,"length2":76},{"diffs":[[0,"Callback(err) {\n"],[1,"    "],[0,"        console."]],"start1":2788,"start2":2788,"length1":32,"length2":36},{"diffs":[[0,"accountId);\n"],[1,"    "],[0,"    });\n  };"]],"start1":2866,"start2":2866,"length1":24,"length2":28},{"diffs":[[0,"      });\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  var forgot"]],"start1":2880,"start2":2880,"length1":28,"length2":32},{"diffs":[[0,"rl, callback) {\n"],[1,"    "],[0,"    var user = A"]],"start1":2953,"start2":2953,"length1":32,"length2":36},{"diffs":[[0,"nt.findOne({"],[1,"\n            "],[0,"email: email"]],"start1":2993,"start2":2993,"length1":24,"length2":37},{"diffs":[[0,"l: email"],[1,"\n        "],[0,"}, funct"]],"start1":3022,"start2":3022,"length1":16,"length2":25},{"diffs":[[0,"nt(err, doc)"],[1," "],[0,"{\n"],[1,"      "],[0,"      if (er"]],"start1":3060,"start2":3060,"length1":26,"length2":33},{"diffs":[[0,"        "],[1,"    "],[1,"    "],[0,"// Email"]],"start1":3098,"start2":3098,"length1":16,"length2":24},{"diffs":[[0,"id user\n"],[1,"        "],[0,"        "]],"start1":3143,"start2":3143,"length1":16,"length2":24},{"diffs":[[0,"lse);\n      "],[1," "],[-1,"} else {\n"],[1,"     }\n            else {\n        "],[0,"        var "]],"start1":3178,"start2":3178,"length1":33,"length2":59},{"diffs":[[0,"nfig.mail);\n"],[1,"        "],[0,"        rese"]],"start1":3290,"start2":3290,"length1":24,"length2":32},{"diffs":[[0,"        "],[1,"       "],[1," "],[0,"smtpTran"]],"start1":3361,"start2":3361,"length1":16,"length2":24},{"diffs":[[0,"dMail({\n"],[1,"          "],[0,"        "]],"start1":3394,"start2":3394,"length1":16,"length2":26},{"diffs":[[0,"        "],[1,"  "],[1,"        "],[0,"to: doc."]],"start1":3453,"start2":3453,"length1":16,"length2":26},{"diffs":[[0,"        "],[1,"     "],[1,"     "],[0,"subject:"]],"start1":3488,"start2":3488,"length1":16,"length2":26},{"diffs":[[0,"        "],[1,"         "],[1," "],[0,"text: 'C"]],"start1":3547,"start2":3547,"length1":16,"length2":26},{"diffs":[[0,"wordUrl\n"],[1,"        "],[0,"        "]],"start1":3620,"start2":3620,"length1":16,"length2":24},{"diffs":[[0,"rr) {\n          "],[1,"    "],[1,"      "],[0,"if (err) {\n     "]],"start1":3678,"start2":3678,"length1":32,"length2":42},{"diffs":[[0,") {\n            "],[1,"       "],[1,"     "],[0,"callback(false);"]],"start1":3711,"start2":3711,"length1":32,"length2":44},{"diffs":[[0,"        "],[1,"        "],[-1,"}"],[1,"  }\n                   "],[0," else {\n"]],"start1":3758,"start2":3758,"length1":17,"length2":47},{"diffs":[[0,"e {\n            "],[1,"     "],[1,"       "],[0,"callback(true);\n"]],"start1":3801,"start2":3801,"length1":32,"length2":44},{"diffs":[[0,"        "],[1,"      "],[-1,"}\n"],[1,"    }\n   "],[0,"        "],[1,"     "],[0,"});\n    "]],"start1":3847,"start2":3847,"length1":26,"length2":44},{"diffs":[[0,";\n      "],[1," "],[-1,"}\n"],[1,"     }\n  "],[0,"    "],[1,"  "],[0,"});\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  var lo"]],"start1":3885,"start2":3885,"length1":32,"length2":46},{"diffs":[[0,"callback) {\n    "],[1," "],[1,"   "],[0,"var shaSum = cry"]],"start1":3963,"start2":3963,"length1":32,"length2":36},{"diffs":[[0,"Hash('sha256');\n"],[1,"    "],[0,"    shaSum.updat"]],"start1":4009,"start2":4009,"length1":32,"length2":36},{"diffs":[[0,"(password);\n"],[1,"    "],[0,"    Account."]],"start1":4046,"start2":4046,"length1":24,"length2":28},{"diffs":[[0,"ne({"],[1,"\n            "],[0,"email:"],[1," "],[0,"email,"],[1,"\n            "],[0,"pass"]],"start1":4079,"start2":4079,"length1":20,"length2":47},{"diffs":[[0,"assword:"],[1," "],[0,"shaSum.d"]],"start1":4123,"start2":4123,"length1":16,"length2":17},{"diffs":[[0,"t('hex')"],[1,"\n        "],[0,"},"],[1," "],[0,"function"]],"start1":4144,"start2":4144,"length1":18,"length2":28},{"diffs":[[0,"err,"],[1," "],[0,"doc)"],[1," "],[0,"{\n      "],[1,"  "],[1,"    "],[0,"call"]],"start1":4173,"start2":4173,"length1":20,"length2":28},{"diffs":[[0,"k(doc);\n    "],[1,"  "],[1,"  "],[0,"});\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  var findBy"]],"start1":4204,"start2":4204,"length1":34,"length2":42},{"diffs":[[0,"back) {\n    "],[1," "],[1,"   "],[0,"var searchRe"]],"start1":4279,"start2":4279,"length1":24,"length2":28},{"diffs":[[0,"hStr, 'i');\n"],[1,"    "],[0,"    Account."]],"start1":4329,"start2":4329,"length1":24,"length2":28},{"diffs":[[0,".find({\n"],[1,"      "],[0,"      $o"]],"start1":4356,"start2":4356,"length1":16,"length2":22},{"diffs":[[0,"  $or: ["],[-1,"\n"],[1,"{\n      "],[0,"        "],[-1,"{"],[1," "],[0," 'name.f"]],"start1":4374,"start2":4374,"length1":26,"length2":33},{"diffs":[[0,"': {"],[-1," $regex: searchRegex } },\n"],[1,"\n                    $regex: searchRegex\n                }\n            }, {\n       "],[0,"        "],[-1,"{"],[0," email:"],[1," {\n          "],[0,"       "],[-1,"{"],[1,"  "],[0," $re"]],"start1":4410,"start2":4410,"length1":58,"length2":128},{"diffs":[[0,"rchRegex"],[1,"\n              "],[0," "],[-1,"}"],[0," }\n     "]],"start1":4546,"start2":4546,"length1":18,"length2":32},{"diffs":[[0,"    "],[1," "],[1,"     }"],[0,"]\n"],[1,"    "],[0,"    "]],"start1":4575,"start2":4575,"length1":10,"length2":21},{"diffs":[[0,"lback);\n"],[1,"  "],[0,"  };\n\n"],[1,"  "],[0,"  var fi"]],"start1":4602,"start2":4602,"length1":22,"length2":26},{"diffs":[[0,"callback) {\n"],[1,"    "],[0,"    Account."]],"start1":4657,"start2":4657,"length1":24,"length2":28},{"diffs":[[0,"indOne({"],[1,"\n            "],[0,"_id:"],[1," "],[0,"accountI"]],"start1":4686,"start2":4686,"length1":20,"length2":34},{"diffs":[[0,"ccountId"],[1,"\n        "],[0,"}, funct"]],"start1":4713,"start2":4713,"length1":16,"length2":25},{"diffs":[[0,"ion(err,"],[1," "],[0,"doc) {\n "]],"start1":4738,"start2":4738,"length1":16,"length2":17},{"diffs":[[0,"oc) {\n      "],[1,"    "],[1,"  "],[0,"callback(doc"]],"start1":4748,"start2":4748,"length1":24,"length2":30},{"diffs":[[0,"lback(doc);\n"],[1,"    "],[0,"    });\n  };"]],"start1":4769,"start2":4769,"length1":24,"length2":28},{"diffs":[[0,"      });\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  var addCon"]],"start1":4783,"start2":4783,"length1":28,"length2":32},{"diffs":[[0,"ct) {\n      "],[1,"  "],[0,"console.log("]],"start1":4848,"start2":4848,"length1":24,"length2":26},{"diffs":[[0,"t:');\n      "],[1," "],[1," "],[0,"//console.di"]],"start1":4894,"start2":4894,"length1":24,"length2":26},{"diffs":[[0,"dcontact);\n\n"],[1,"    "],[0,"    var cont"]],"start1":4924,"start2":4924,"length1":24,"length2":28},{"diffs":[[0,"{\n      "],[1,"  "],[1,"    "],[0,"name: {"],[1,"\n                "],[0,"first: a"]],"start1":4958,"start2":4958,"length1":23,"length2":46},{"diffs":[[0,"e.first,"],[1,"\n               "],[0," last: a"]],"start1":5017,"start2":5017,"length1":16,"length2":32},{"diffs":[[0,"ame.last"],[-1,"},\n"],[1,"\n            },\n      "],[0,"      ac"]],"start1":5060,"start2":5060,"length1":19,"length2":38},{"diffs":[[0,"._id,\n      "],[1,"   "],[1,"   "],[0,"added: new D"]],"start1":5117,"start2":5117,"length1":24,"length2":30},{"diffs":[[0,"te(),\n      "],[1,"    "],[1,"  "],[0,"updated: new"]],"start1":5148,"start2":5148,"length1":24,"length2":30},{"diffs":[[0," Date()\n"],[1,"    "],[0,"    };\n "]],"start1":5178,"start2":5178,"length1":16,"length2":20},{"diffs":[[0,"     };\n    "],[1," "],[1,"   "],[0,"//console.di"]],"start1":5189,"start2":5189,"length1":24,"length2":28},{"diffs":[[0,"r(contact);\n"],[1,"    "],[0,"    account."]],"start1":5217,"start2":5217,"length1":24,"length2":28},{"diffs":[[0,"(contact);\n\n"],[1,"    "],[0,"    account."]],"start1":5258,"start2":5258,"length1":24,"length2":28},{"diffs":[[0,"function"],[-1," "],[0,"(err) {\n"]],"start1":5291,"start2":5291,"length1":17,"length2":16},{"diffs":[[0,"rr) {\n      "],[1," "],[1,"     "],[0,"if (err) {\n "]],"start1":5301,"start2":5301,"length1":24,"length2":30},{"diffs":[[0,"     if (err) {\n"],[1,"        "],[0,"        console."]],"start1":5314,"start2":5314,"length1":32,"length2":40},{"diffs":[[0,": ' + err);\n"],[1,"      "],[0,"      }\n    "]],"start1":5379,"start2":5379,"length1":24,"length2":30},{"diffs":[[0,"    "],[1," "],[1,"   "],[0,"});\n"],[1,"  "],[0,"  };\n\n  "],[1," "],[1," "],[0,"var "]],"start1":5405,"start2":5405,"length1":20,"length2":28},{"diffs":[[0,"ontactId) {\n"],[1,"    "],[0,"    if ("],[-1," "],[0,"null === acc"]],"start1":5468,"start2":5468,"length1":33,"length2":36},{"diffs":[[0,"account.contacts"],[-1," "],[0,") return;\n\n    a"]],"start1":5501,"start2":5501,"length1":33,"length2":32},{"diffs":[[0,"eturn;\n\n"],[1,"    "],[0,"    acco"]],"start1":5520,"start2":5520,"length1":16,"length2":20},{"diffs":[[0,"ontact) {\n      "],[1,"   "],[1,"   "],[0,"if ("],[-1," "],[0,"contact.accountI"]],"start1":5571,"start2":5571,"length1":37,"length2":42},{"diffs":[[0,"tId == contactId"],[-1," "],[0,") {\n"],[1,"        "],[0,"        account."]],"start1":5611,"start2":5611,"length1":37,"length2":44},{"diffs":[[0,"e(contact);\n"],[1,"      "],[0,"      }\n    "]],"start1":5669,"start2":5669,"length1":24,"length2":30},{"diffs":[[0,"  }\n    "],[1," "],[1,"   "],[0,"});\n    "],[1,"   "],[1," "],[0,"account."]],"start1":5691,"start2":5691,"length1":24,"length2":32},{"diffs":[[0,"save();\n"],[1,"  "],[0,"  };\n\n"],[1,"  "],[0,"  var ha"]],"start1":5723,"start2":5723,"length1":22,"length2":26},{"diffs":[[0,") {\n    "],[1,"  "],[1,"  "],[0,"if ("],[-1," "],[0,"null ==="]],"start1":5787,"start2":5787,"length1":21,"length2":24},{"diffs":[[0,"contacts"],[-1," "],[0,") return"]],"start1":5820,"start2":5820,"length1":17,"length2":16},{"diffs":[[0,"false;\n\n    "],[1,"  "],[1,"  "],[0,"account.cont"]],"start1":5837,"start2":5837,"length1":24,"length2":28},{"diffs":[[0,"(contact) {\n"],[1,"      "],[0,"      if ( c"]],"start1":5886,"start2":5886,"length1":24,"length2":30},{"diffs":[[0,"    if ("],[-1," "],[0,"contact."]],"start1":5906,"start2":5906,"length1":17,"length2":16},{"diffs":[[0,"ontactId"],[-1," "],[0,") {\n    "]],"start1":5936,"start2":5936,"length1":17,"length2":16},{"diffs":[[0,") {\n        "],[1,"    "],[1,"    "],[0,"return true;"]],"start1":5944,"start2":5944,"length1":24,"length2":32},{"diffs":[[0,";\n      "],[-1,"}\n"],[1,"      }\n   "],[0,"    "],[1," "],[0,"});\n"],[1,"    "],[0,"    retu"]],"start1":5975,"start2":5975,"length1":26,"length2":40},{"diffs":[[0," false;\n"],[1,"  "],[0,"  };\n\n"],[1,"  "],[0,"  var re"]],"start1":6017,"start2":6017,"length1":22,"length2":26},{"diffs":[[0,"lastName) {\n"],[1,"    "],[0,"    var shaS"]],"start1":6089,"start2":6089,"length1":24,"length2":28},{"diffs":[[0,"('sha256');\n"],[1,"    "],[0,"    shaSum.u"]],"start1":6139,"start2":6139,"length1":24,"length2":28},{"diffs":[[0,"word);\n\n    "],[1,"   "],[1," "],[0,"console.log("]],"start1":6177,"start2":6177,"length1":24,"length2":28},{"diffs":[[0,"' + email);\n"],[1,"    "],[0,"    var user"]],"start1":6218,"start2":6218,"length1":24,"length2":28},{"diffs":[[0,"unt({\n      "],[1," "],[1,"     "],[0,"email: email"]],"start1":6257,"start2":6257,"length1":24,"length2":30},{"diffs":[[0,"mail,\n      "],[1,"  "],[1,"    "],[0,"name: {\n    "]],"start1":6283,"start2":6283,"length1":24,"length2":30},{"diffs":[[0,": {\n        "],[1,"   "],[1,"     "],[0,"first: first"]],"start1":6305,"start2":6305,"length1":24,"length2":32},{"diffs":[[0,"rst: firstName,\n"],[1,"        "],[0,"        last: la"]],"start1":6327,"start2":6327,"length1":32,"length2":40},{"diffs":[[0,"last: lastName,\n"],[1,"        "],[0,"        full: fi"]],"start1":6359,"start2":6359,"length1":32,"length2":40},{"diffs":[[0,"tName\n      "],[1,"     "],[1," "],[0,"},\n"],[1,"      "],[0,"      passwo"]],"start1":6418,"start2":6418,"length1":27,"length2":39},{"diffs":[[0,"gest('hex')\n"],[1,"    "],[0,"    });\n    "]],"start1":6470,"start2":6470,"length1":24,"length2":28},{"diffs":[[0,"});\n    "],[1,"  "],[1,"  "],[0,"user.sav"]],"start1":6490,"start2":6490,"length1":16,"length2":20},{"diffs":[[0,"rCallback);\n"],[1,"    "],[0,"    console."]],"start1":6519,"start2":6519,"length1":24,"length2":28},{"diffs":[[0,"nt');\n  "],[1," "],[1," "],[0,"};\n\n"],[1,"  "],[0,"  return"]],"start1":6571,"start2":6571,"length1":20,"length2":24},{"diffs":[[0,"eturn {\n    "],[1,"   "],[1," "],[0,"findById: fi"]],"start1":6590,"start2":6590,"length1":24,"length2":28},{"diffs":[[0,"Id,\n    "],[1,"   "],[1," "],[0,"register"]],"start1":6622,"start2":6622,"length1":16,"length2":20},{"diffs":[[0,"er,\n    "],[1,"  "],[1,"  "],[0,"hasConta"]],"start1":6650,"start2":6650,"length1":16,"length2":20},{"diffs":[[0,"hasContact,\n"],[1,"    "],[0,"    forgotPa"]],"start1":6674,"start2":6674,"length1":24,"length2":28},{"diffs":[[0,"otPassword,\n"],[1,"    "],[0,"    changePa"]],"start1":6714,"start2":6714,"length1":24,"length2":28},{"diffs":[[0,"ssword,\n    "],[1,"   "],[1," "],[0,"findByString"]],"start1":6758,"start2":6758,"length1":24,"length2":28},{"diffs":[[0,"ndByString,\n"],[1,"    "],[0,"    addConta"]],"start1":6790,"start2":6790,"length1":24,"length2":28},{"diffs":[[0,"ct,\n    "],[1," "],[1,"   "],[0,"removeCo"]],"start1":6830,"start2":6830,"length1":16,"length2":20},{"diffs":[[0,"oveContact,\n"],[1,"    "],[0,"    login: l"]],"start1":6860,"start2":6860,"length1":24,"length2":28},{"diffs":[[0," login,\n"],[1,"    "],[0,"    Acco"]],"start1":6886,"start2":6886,"length1":16,"length2":20},{"diffs":[[0,"Account\n"],[1,"  "],[0,"  }\n}\n"]],"start1":6911,"start2":6911,"length1":14,"length2":16}]],"length":6927,"saved":false}
