{"ts":1358110573096,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports = function(app, models) {\n  app.post('/login', function(req, res) {\n    var email = req.param('email', null);\n    var password = req.param('password', null);\n  \n    if ( null == email || email.length < 1\n        || null == password || password.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.login(email, password, function(account) {\n      if ( !account ) {\n        res.send(401);\n        return;\n      }\n      req.session.loggedIn = true;\n      req.session.accountId = account._id;\n      res.send(account._id);\n    });\n  });\n  \n  app.post('/register', function(req, res) {\n    var firstName = req.param('firstName', '');\n    var lastName = req.param('lastName', '');\n    var email = req.param('email', null);\n    var password = req.param('password', null);\n  \n    if ( null == email || email.length < 1\n         || null == password || password.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.register(email, password, firstName, lastName);\n    res.send(200);\n  });\n  \n  app.get('/account/authenticated', function(req, res) {\n    if ( req.session && req.session.loggedIn ) {\n      res.send(req.session.accountId);\n    } else {\n      res.send(401);\n    }\n  });\n  \n  app.post('/forgotpassword', function(req, res) {\n    var hostname = req.headers.host;\n    var resetPasswordUrl = 'http://' + hostname + '/resetPassword';\n    var email = req.param('email', null);\n    if ( null == email || email.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.forgotPassword(email, resetPasswordUrl, function(success){\n      if (success) {\n        res.send(200);\n      } else {\n        // Username or password not found\n        res.send(404);\n      }\n    });\n  });\n\n  app.get('/resetPassword', function(req, res) {\n    var accountId = req.param('account', null);\n    res.render('resetPassword.jade', {locals:{accountId:accountId}});\n  });\n  \n  app.post('/resetPassword', function(req, res) {\n    var accountId = req.param('accountId', null);\n    var password = req.param('password', null);\n    if ( null != accountId && null != password ) {\n      models.Account.changePassword(accountId, password);\n    }\n    res.render('resetPasswordSuccess.jade');\n  });\n}"]],"start1":0,"start2":0,"length1":0,"length2":2244}]],"length":2244}
{"contributors":[],"silentsave":false,"ts":1358110702730,"patch":[[{"diffs":[[0,"dels) {\n"],[1,"  "],[0,"  app.po"]],"start1":33,"start2":33,"length1":16,"length2":18},{"diffs":[[0," res) {\n    "],[1,"    "],[0,"var email = "]],"start1":77,"start2":77,"length1":24,"length2":28},{"diffs":[[0,"il', null);\n    "],[1,"    "],[0,"var password = r"]],"start1":119,"start2":119,"length1":32,"length2":36},{"diffs":[[0," null);\n"],[1,"\n "],[0,"  "],[-1,"\n"],[0,"    "],[1," "],[0,"if ("],[-1," "],[0,"null =="],[1,"="],[0," email |"]],"start1":175,"start2":175,"length1":35,"length2":37},{"diffs":[[0,"ngth < 1"],[-1,"\n       "],[0," || null"]],"start1":222,"start2":222,"length1":24,"length2":16},{"diffs":[[0,"h < 1 || null =="],[1,"="],[0," password || pas"]],"start1":225,"start2":225,"length1":32,"length2":33},{"diffs":[[0,"sword.length < 1"],[-1," "],[0,") {\n"],[1,"      "],[0,"      res.send(4"]],"start1":258,"start2":258,"length1":37,"length2":42},{"diffs":[[0,"end(400);\n      "],[1,"      "],[0,"return;\n    }\n  "]],"start1":295,"start2":295,"length1":32,"length2":38},{"diffs":[[0,"    return;\n    "],[1,"    "],[0,"}\n"],[1,"\n "],[0,"  "],[-1,"\n"],[1," "],[0,"    models.Accou"]],"start1":313,"start2":313,"length1":37,"length2":43},{"diffs":[[0,"    "],[1,"      "],[0,"if ("],[-1," "],[0,"!account"],[-1," "],[0,") {\n"]],"start1":404,"start2":404,"length1":22,"length2":26},{"diffs":[[0,"ount) {\n        "],[1,"        "],[0,"res.send(401);\n "]],"start1":422,"start2":422,"length1":32,"length2":40},{"diffs":[[0,"    "],[1,"        "],[0,"return;\n"],[1,"      "],[0,"      }\n"],[1,"      "],[0,"    "]],"start1":465,"start2":465,"length1":24,"length2":44},{"diffs":[[0,"= true;\n"],[1,"      "],[0,"      re"]],"start1":532,"start2":532,"length1":16,"length2":22},{"diffs":[[0,"._id;\n      "],[1,"      "],[0,"res.send(acc"]],"start1":583,"start2":583,"length1":24,"length2":30},{"diffs":[[0,"d);\n"],[1,"    "],[0,"    });\n"],[1,"  "],[0,"  });\n"],[1,"\n"],[0,"  "],[-1,"\n"],[0,"  ap"]],"start1":620,"start2":620,"length1":25,"length2":31},{"diffs":[[0," res) {\n    "],[1,"    "],[0,"var firstNam"]],"start1":684,"start2":684,"length1":24,"length2":28},{"diffs":[[0,"', '');\n    "],[1,"    "],[0,"var lastName"]],"start1":736,"start2":736,"length1":24,"length2":28},{"diffs":[[0,"Name', '');\n"],[1,"    "],[0,"    var emai"]],"start1":782,"start2":782,"length1":24,"length2":28},{"diffs":[[0,"'email', null);\n"],[1,"    "],[0,"    var password"]],"start1":824,"start2":824,"length1":32,"length2":36},{"diffs":[[0,"l);\n"],[1,"\n"],[0,"  "],[-1,"\n"],[0,"    "],[1,"  "],[0,"if ("],[-1," "],[0,"null =="],[1,"="],[0," ema"]],"start1":888,"start2":888,"length1":27,"length2":29},{"diffs":[[0,"ngth < 1"],[-1,"\n        "],[0," || null"]],"start1":931,"start2":931,"length1":25,"length2":16},{"diffs":[[0," null =="],[1,"="],[0," passwor"]],"start1":942,"start2":942,"length1":16,"length2":17},{"diffs":[[0,"sword.length < 1"],[-1," "],[0,") {\n      res.se"]],"start1":967,"start2":967,"length1":33,"length2":32},{"diffs":[[0,"th < 1) {\n      "],[1,"      "],[0,"res.send(400);\n "]],"start1":977,"start2":977,"length1":32,"length2":38},{"diffs":[[0," res.send(400);\n"],[1,"      "],[0,"      return;\n  "]],"start1":998,"start2":998,"length1":32,"length2":38},{"diffs":[[0,"    return;\n"],[1,"    "],[0,"    }\n"],[1,"\n"],[0,"  "],[-1,"\n"],[1,"  "],[0,"    models.A"]],"start1":1022,"start2":1022,"length1":33,"length2":39},{"diffs":[[0,"tName);\n    "],[1,"    "],[0,"res.send(200"]],"start1":1108,"start2":1108,"length1":24,"length2":28},{"diffs":[[0,"d(200);\n"],[1,"  "],[0,"  });\n"],[1,"\n"],[0,"  "],[-1,"\n"],[0,"  app.ge"]],"start1":1131,"start2":1131,"length1":25,"length2":27},{"diffs":[[0,") {\n    "],[1,"    "],[0,"if ("],[-1," "],[0,"req.sess"]],"start1":1203,"start2":1203,"length1":21,"length2":24},{"diffs":[[0,"loggedIn"],[-1," "],[0,") {\n    "]],"start1":1246,"start2":1246,"length1":17,"length2":16},{"diffs":[[0,"ggedIn) {\n      "],[1,"      "],[0,"res.send(req.ses"]],"start1":1248,"start2":1248,"length1":32,"length2":38},{"diffs":[[0,"untId);\n    "],[-1,"}"],[1,"    }\n       "],[0," else {\n    "]],"start1":1295,"start2":1295,"length1":25,"length2":37},{"diffs":[[0,"   else {\n      "],[1,"      "],[0,"res.send(401);\n "]],"start1":1318,"start2":1318,"length1":32,"length2":38},{"diffs":[[0,"    "],[1,"    "],[0,"}\n  "],[1,"  "],[0,"});\n"],[1,"\n"],[0,"  "],[-1,"\n"],[0,"  ap"]],"start1":1355,"start2":1355,"length1":19,"length2":25},{"diffs":[[0,"ion(req, res) {\n"],[1,"    "],[0,"    var hostname"]],"start1":1411,"start2":1411,"length1":32,"length2":36},{"diffs":[[0,"s.host;\n    "],[1,"    "],[0,"var resetPas"]],"start1":1460,"start2":1460,"length1":24,"length2":28},{"diffs":[[0,"sword';\n"],[1,"    "],[0,"    var "]],"start1":1532,"start2":1532,"length1":16,"length2":20},{"diffs":[[0,"    "],[1,"    "],[0,"if ("],[-1," "],[0,"null =="],[1,"="],[0," ema"]],"start1":1586,"start2":1586,"length1":20,"length2":24},{"diffs":[[0,"ngth < 1"],[-1," "],[0,") {\n    "]],"start1":1624,"start2":1624,"length1":17,"length2":16},{"diffs":[[0," 1) {\n      "],[1,"      "],[0,"res.send(400"]],"start1":1630,"start2":1630,"length1":24,"length2":30},{"diffs":[[0,"400);\n      "],[1,"      "],[0,"return;\n    "]],"start1":1657,"start2":1657,"length1":24,"length2":30},{"diffs":[[0,"    "],[-1,"}\n  \n"],[1,"    }\n\n    "],[0,"    "]],"start1":1683,"start2":1683,"length1":13,"length2":19},{"diffs":[[0,"success)"],[1," "],[0,"{\n"],[1,"      "],[0,"      if"]],"start1":1766,"start2":1766,"length1":18,"length2":25},{"diffs":[[0,"cess) {\n        "],[1,"        "],[0,"res.send(200);\n "]],"start1":1796,"start2":1796,"length1":32,"length2":40},{"diffs":[[0,";\n      "],[-1,"}"],[1,"      }\n           "],[0," else {\n"]],"start1":1833,"start2":1833,"length1":17,"length2":35},{"diffs":[[0,"        "],[1,"        "],[0,"// Usern"]],"start1":1868,"start2":1868,"length1":16,"length2":24},{"diffs":[[0,"t found\n"],[1,"        "],[0,"        "]],"start1":1910,"start2":1910,"length1":16,"length2":24},{"diffs":[[0,";\n      "],[1,"      "],[0,"}\n    "],[1,"    "],[0,"});\n"],[1,"  "],[0,"  });\n\n "]],"start1":1947,"start2":1947,"length1":26,"length2":38},{"diffs":[[0," });\n\n  "],[1,"  "],[0,"app.get("]],"start1":1978,"start2":1978,"length1":16,"length2":18},{"diffs":[[0,"ion(req, res) {\n"],[1,"    "],[0,"    var accountI"]],"start1":2019,"start2":2019,"length1":32,"length2":36},{"diffs":[[0," null);\n    "],[1,"    "],[0,"res.render('"]],"start1":2079,"start2":2079,"length1":24,"length2":28},{"diffs":[[0,"', {"],[-1,"locals:{"],[1,"\n            locals: {\n                "],[0,"acco"]],"start1":2125,"start2":2125,"length1":16,"length2":47},{"diffs":[[0,"countId:"],[1," "],[0,"accountI"]],"start1":2170,"start2":2170,"length1":16,"length2":17},{"diffs":[[0,"ntId"],[-1,"}"],[1,"\n            }\n        "],[0,"});\n"],[1,"  "],[0,"  });\n"],[1,"\n"],[0,"  "],[-1,"\n"],[0,"  ap"]],"start1":2184,"start2":2184,"length1":22,"length2":46},{"diffs":[[0," res) {\n    "],[1,"    "],[0,"var accountI"]],"start1":2268,"start2":2268,"length1":24,"length2":28},{"diffs":[[0,"Id', null);\n"],[1,"    "],[0,"    var pass"]],"start1":2318,"start2":2318,"length1":24,"length2":28},{"diffs":[[0,"l);\n"],[1,"    "],[0,"    if ("],[-1," "],[0,"null !="],[1,"="],[0," acc"]],"start1":2378,"start2":2378,"length1":24,"length2":28},{"diffs":[[0," null !="],[1,"="],[0," passwor"]],"start1":2415,"start2":2415,"length1":16,"length2":17},{"diffs":[[0,"password"],[-1," "],[0,") {\n    "]],"start1":2425,"start2":2425,"length1":17,"length2":16},{"diffs":[[0,"rd) {\n      "],[1,"      "],[0,"models.Accou"]],"start1":2431,"start2":2431,"length1":24,"length2":30},{"diffs":[[0," password);\n"],[1,"    "],[0,"    }\n    re"]],"start1":2489,"start2":2489,"length1":24,"length2":28},{"diffs":[[0,"      }\n    "],[1,"    "],[0,"res.render('"]],"start1":2503,"start2":2503,"length1":24,"length2":28},{"diffs":[[0,"');\n"],[1,"  "],[0,"  });\n}"],[1,";"]],"start1":2556,"start2":2556,"length1":11,"length2":14}]],"length":2570,"saved":false}
