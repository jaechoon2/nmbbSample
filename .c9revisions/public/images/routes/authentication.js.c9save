{"ts":1357692207655,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports = function(app, models) {\n  app.post('/login', function(req, res) {\n    var email = req.param('email', null);\n    var password = req.param('password', null);\n  \n    if ( null == email || email.length < 1\n        || null == password || password.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.login(email, password, function(account) {\n      if ( !account ) {\n        res.send(401);\n        return;\n      }\n      req.session.loggedIn = true;\n      req.session.accountId = account._id;\n      res.send(account._id);\n    });\n  });\n  \n  app.post('/register', function(req, res) {\n    var firstName = req.param('firstName', '');\n    var lastName = req.param('lastName', '');\n    var email = req.param('email', null);\n    var password = req.param('password', null);\n  \n    if ( null == email || email.length < 1\n         || null == password || password.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.register(email, password, firstName, lastName);\n    res.send(200);\n  });\n  \n  app.get('/account/authenticated', function(req, res) {\n    if ( req.session && req.session.loggedIn ) {\n      res.send(req.session.accountId);\n    } else {\n      res.send(401);\n    }\n  });\n  \n  app.post('/forgotpassword', function(req, res) {\n    var hostname = req.headers.host;\n    var resetPasswordUrl = 'http://' + hostname + '/resetPassword';\n    var email = req.param('email', null);\n    if ( null == email || email.length < 1 ) {\n      res.send(400);\n      return;\n    }\n  \n    models.Account.forgotPassword(email, resetPasswordUrl, function(success){\n      if (success) {\n        res.send(200);\n      } else {\n        // Username or password not found\n        res.send(404);\n      }\n    });\n  });\n\n  app.get('/resetPassword', function(req, res) {\n    var accountId = req.param('account', null);\n    res.render('resetPassword.jade', {locals:{accountId:accountId}});\n  });\n  \n  app.post('/resetPassword', function(req, res) {\n    var accountId = req.param('accountId', null);\n    var password = req.param('password', null);\n    if ( null != accountId && null != password ) {\n      models.Account.changePassword(accountId, password);\n    }\n    res.render('resetPasswordSuccess.jade');\n  });\n}"]],"start1":0,"start2":0,"length1":0,"length2":2244}]],"length":2244}
